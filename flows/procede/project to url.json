[
    {
        "id": "c24cc92d30737b65",
        "type": "subflow",
        "name": "exists url",
        "info": "",
        "category": "procede",
        "in": [
            {
                "x": 220,
                "y": 400,
                "wires": [
                    {
                        "id": "19507bd1feef36d9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1300,
                "y": 660,
                "wires": [
                    {
                        "id": "dd688433e3744555",
                        "port": 0
                    },
                    {
                        "id": "45ed35959725f8a2",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "cardId",
                "type": "str",
                "value": ""
            },
            {
                "name": "key",
                "type": "str",
                "value": ""
            },
            {
                "name": "trelloToken",
                "type": "str",
                "value": ""
            },
            {
                "name": "githubToken",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "4293b91d7c9ffb9a",
        "type": "http request",
        "z": "c24cc92d30737b65",
        "name": "Trello request",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.trello.com/1/cards/{{cardId}}/attachments?key={{key}}&token={{trelloToken}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 540,
        "y": 400,
        "wires": [
            [
                "976f962dc8b95353"
            ]
        ]
    },
    {
        "id": "19507bd1feef36d9",
        "type": "function",
        "z": "c24cc92d30737b65",
        "name": "Auxiliaries",
        "func": "msg.cardId = env.get(\"cardId\");\nmsg.key = env.get(\"key\");\nmsg.trelloToken = env.get(\"trelloToken\");\nmsg.githubToken = env.get(\"githubToken\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 400,
        "wires": [
            [
                "4293b91d7c9ffb9a"
            ]
        ]
    },
    {
        "id": "976f962dc8b95353",
        "type": "function",
        "z": "c24cc92d30737b65",
        "name": "GitHub URL",
        "func": "var jsonData = msg.payload;\n\nmsg.payload = jsonData.toString().indexOf('github') != -1;\n\nif(msg.payload) {\n    msg.githubRepoUrl = JSON.parse(jsonData)[0].url;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 400,
        "wires": [
            [
                "45ed35959725f8a2"
            ]
        ]
    },
    {
        "id": "dd688433e3744555",
        "type": "function",
        "z": "c24cc92d30737b65",
        "name": "Exists repo",
        "func": "msg.payload = msg.statusCode === 200;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "22de7ce057115acd",
        "type": "http request",
        "z": "c24cc92d30737b65",
        "name": "GitHub request",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.github.com/repos/{{username}}/{{repoName}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 940,
        "y": 580,
        "wires": [
            [
                "dd688433e3744555"
            ]
        ]
    },
    {
        "id": "45ed35959725f8a2",
        "type": "switch",
        "z": "c24cc92d30737b65",
        "name": "If the card is associated",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 350,
        "y": 660,
        "wires": [
            [
                "5ea3e9ceb594dedb"
            ],
            []
        ]
    },
    {
        "id": "5ea3e9ceb594dedb",
        "type": "function",
        "z": "c24cc92d30737b65",
        "name": "Obtain username and repo name",
        "func": "var githubRepoUrl = msg.githubRepoUrl;\n\nvar regex = /^https:\\/\\/github\\.com\\/([^\\/]+)\\/([^\\/]+)\\/?(tree\\/[^\\/]+)?\\/?$/; \nvar match = githubRepoUrl.match(regex); \nmsg.username = match[1]; \nmsg.repoName = match[2];\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + msg.githubToken;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 580,
        "wires": [
            [
                "22de7ce057115acd"
            ]
        ]
    },
    {
        "id": "e11c5db9a3433093",
        "type": "subflow",
        "name": "project to url",
        "info": "",
        "category": "procede",
        "in": [
            {
                "x": 120,
                "y": 360,
                "wires": [
                    {
                        "id": "157726a19f27f58c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1220,
                "y": 360,
                "wires": [
                    {
                        "id": "97cb9570dae8ba46",
                        "port": 0
                    },
                    {
                        "id": "209148e5d2dafe3b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "cardId",
                "type": "str",
                "value": ""
            },
            {
                "name": "key",
                "type": "str",
                "value": ""
            },
            {
                "name": "trelloToken",
                "type": "str",
                "value": ""
            },
            {
                "name": "githubToken",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "248a4c09df3eb35a",
        "type": "subflow:c24cc92d30737b65",
        "z": "e11c5db9a3433093",
        "name": "",
        "env": [
            {
                "name": "cardId",
                "value": "cardId",
                "type": "env"
            },
            {
                "name": "key",
                "value": "key",
                "type": "env"
            },
            {
                "name": "trelloToken",
                "value": "trelloToken",
                "type": "env"
            },
            {
                "name": "githubToken",
                "value": "githubToken",
                "type": "env"
            }
        ],
        "x": 420,
        "y": 360,
        "wires": [
            [
                "5f05c13b7fc64e01"
            ]
        ]
    },
    {
        "id": "5f05c13b7fc64e01",
        "type": "switch",
        "z": "e11c5db9a3433093",
        "name": "If exists",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 580,
        "y": 360,
        "wires": [
            [
                "2edfa1a8112a2548"
            ],
            [
                "97cb9570dae8ba46"
            ]
        ]
    },
    {
        "id": "97cb9570dae8ba46",
        "type": "function",
        "z": "e11c5db9a3433093",
        "name": "Error message",
        "func": "node.error(\"The input data is not correct or there is no repository on that card.\", msg);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "2edfa1a8112a2548",
        "type": "http request",
        "z": "e11c5db9a3433093",
        "name": "Trello request",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.trello.com/1/cards/{{cardId}}/attachments?key={{key}}&token={{trelloToken}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 820,
        "y": 260,
        "wires": [
            [
                "209148e5d2dafe3b"
            ]
        ]
    },
    {
        "id": "209148e5d2dafe3b",
        "type": "function",
        "z": "e11c5db9a3433093",
        "name": "GitHub URL",
        "func": "var jsonData = msg.payload;\nmsg.payload = JSON.parse(jsonData)[0].url;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "157726a19f27f58c",
        "type": "function",
        "z": "e11c5db9a3433093",
        "name": "Auxiliaries",
        "func": "msg.cardId = env.get(\"cardId\");\nmsg.key = env.get(\"key\");\nmsg.trelloToken = env.get(\"trelloToken\");\nmsg.githubToken = env.get(\"githubToken\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 360,
        "wires": [
            [
                "248a4c09df3eb35a"
            ]
        ]
    }
]